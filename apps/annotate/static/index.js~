$(document).ready(function(){
    populateTabs();
    includeHTML();
});

function populateTabs(){
    console.log(tabs);
    d3.select("#tabs").html("");
    d3.select("#tabs").selectAll("li")
      .data(tabs)
      .enter()
      .append("li")
        .attr("class", "nav-item")
        .append("a")
          .attr("class", "nav-link")
          .classed("active", function(d, i){ return i == 0; })
          .attr("id", function(d){ return d[0]+"-tab"; })
          .attr("data-toggle", "tab")
          .attr("href", function(d){ return "#"+d[0]+"-panel"; })
          .attr("role", "tab")
          .attr("aria-controls", function(d){ return d[0]+"-panel"; })
          .attr("aria-selected", function(d, i){ return String(i == 0); })
          .html(function(d){ return d[1]; });
    d3.select("#panels").html("");
    tab_panels = d3.select("#panels").selectAll("div")
      .data(tabs)
      .enter()
      .append("div")
        .attr("class", "tab_panel tab-pane fade")
        .classed("show active", function(d, i){ return i == 0; })
        .attr("id", function(d){ return d[0]+"-panel"; })
        .attr("role", "tabpanel")
        .attr("aria-labelledby", function(d){ return d[0]+"-tab"; })
        .append("div")
          .style("height", "100%")
          .style("display", "flex")
          .style("flex-direction", "column");
    tab_panels.append("text").html(function(d){ return d[2]; });
    annotation_elements = tab_panels.append("div").attr("w3-include-html", function(d){ return "/static/"+d[3]+".html"; })
      .style("flex", 1)
      .style("display", "flex")
      .style("flex-direction", "column");
    annotation_elements.attr("state", function(d){ return new AnnotateState(d3.select(this)); });
}

// taken from https://www.w3schools.com/howto/howto_html_include.asp
function includeHTML() {
  var z, i, elmnt, file, xhttp;
  /*loop through a collection of all HTML elements:*/
  z = document.getElementsByTagName("*");
  for (i = 0; i < z.length; i++) {
    elmnt = z[i];
    /*search for elements with a certain atrribute:*/
    file = elmnt.getAttribute("w3-include-html");
    if (file) {
      /*make an HTTP request using the attribute value as the file name:*/
      xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4) {
          if (this.status == 200) {elmnt.innerHTML = this.responseText;}
          if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
          /*remove the attribute, and call this function once more:*/
          elmnt.removeAttribute("w3-include-html");
          includeHTML();
        }
      }
      xhttp.open("GET", file, true);
      xhttp.send();
      /*exit the function:*/
      return;
    }
  }
};

function displayLoader(selection) {
    selection.append("div")
        .attr("class", "loader");
}

function closeLoader(selection) {
    selection.selectAll(".loader").remove();
}

function submit() {
    url = 'http://localhost:5000'
    var formData = new FormData();
    formData.append("hello", "world");
    $.post({
        url: url,
        data: formData,
        success: function(result, status){
            location.reload();
        },
        processData: false,
        contentType: false,
    });
}
